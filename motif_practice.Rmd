---
title: "motif_practice"
author: "Andrew"
date: "11/4/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---
# Todo
- fully workflow template
- generate spectrograms
- plots
- summary statistics
- maps showing study site locations 
- import metadata (temp, sensor locations, habitat type)
- Generate a summary description sentences and/or a markdown table (automatically generated using in-text R) based on the metadata. e.g. This site has <properties> and is located <sitelocation>. 
- a way to label / confirm motifs in R??

## Setup
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Install/reinstall
```{r}
#detach("package:motifR", unload=TRUE)
#install("/Users/andrew/Documents/Data Science/Projects/Ecoacoustics/motifR")
#library(motifR)
#cat_function()
```

## Terminology

- Site = a geographic region/area
- Location = an actual sensor

## Step 1

### Download or provide your own data

In this example workflow we will use data available from the A2O.

If you would like to download data from the A20, follow this link: 

```{r}
list.files(path = "data/A2O/", recursive = TRUE)
```

```
. ~/Projects/Ecoacoustics/motifR/data/A2O
├── 253_SEQPSamfordDryA
│   ├── 20210101T140000+1000_SEQP-Samford-Dry-A_69038.flac
│   ├── 20210101T180000+1000_SEQP-Samford-Dry-A_69039.flac
│   ├── 20210102T000000+1000_SEQP-Samford-Dry-A_69041.flac
│   └── 20210102T060000+1000_SEQP-Samford-Dry-A_69040.flac
└── download_audio_files.ps1
```

See some summary information about the files you're working with. My files are from 2021-01-01 to 2021-01-02. From one site, and two locations within that site.  
```{r}
#TODO: nice summary info, number of recordings/files, total hours, total sites etc
```

### Calculate acoustic indices

We will now calculate acoustic indices using the `AnalysisPrograms` package. At the moment, this package supports the folder structure that is generated by `AP` only. In the future, different folder structures may be supported. Note: If you have already generated indices you can skip this step. Or else you can generate the indices directly in your terminal with AP. 

#### Check if AP is available

Problem: The path in RStudio terminal doesn't match the path in the system terminal. I can call `AP` in a terminal, but not in Rstudio terminal. The PATH imported into Rstudio, Rstudio terminal, both seem to be different. Run `Sys.getenv("PATH")` in an Rmarkdown document, and then run `echo $PATH` in Rstudio terminal. Using the below code adds `/Users/andrew/.local/bin` to my path for Rstudio but not Rstudio terminal. This is the path to AP for my system (based on the automatic installer for AP). Still need to test this flow on windows.  

Check your value for path in R terminal. echo $PATH and compare to a real terminal. 

```{r}
find_program("AP")

# if you have installed AP but the above does not work, use the code below:
old_path <- Sys.getenv("PATH")
Sys.setenv(PATH = paste(old_path, "/Users/andrew/.local/bin", sep = ":"))
```

Now we can easily run AP commands in R: 
```{r}
AP("-help")
```

We try to run AP but get an error. The audio file has an error:
```{r}
open_dir()

```

We can run emu:
```{r}
# get the metadata from a2O files and output as a .csv

# fix broken audio files
# pay attention to the ' (doesn't work in mac for some reason) and directory structure. use backslashes to escape a space. use cd to check if your path is correct. 
#cd ~/Documents/Data\ Science/Projects/Ecoacoustics/motifR/data/A2O/

# check the files
#./emu fix check --all ~/Documents/Data\ Science/Projects/Ecoacoustics/motifR/data/A2O/**/*.flac

# the files have the FL010 metadata bug

# fix the files (dry run)
#./emu fix apply -f FL010 --dry-run ~/Documents/Data\ Science/Projects/Ecoacoustics/motifR/data/A2O/**/*.flac

# real run
#./emu fix apply -f FL010 ~/Documents/Data\ Science/Projects/Ecoacoustics/motifR/data/A2O/**/*.flac
```

We fixed the files. Now run the AP analysis:
```{r}
# waiting

```

Motifs have to be run ecosystems and months separately 




